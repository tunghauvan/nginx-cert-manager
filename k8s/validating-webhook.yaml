apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: domaincertificate-validation-webhook
webhooks:
  - name: validate.domaincertificate.cert.nginx.io
    rules:
      - apiGroups: ["cert.nginx.io"]
        apiVersions: ["v1"]
        operations: ["CREATE", "UPDATE"]
        resources: ["domaincertificates"]
        scope: "Namespaced"
    clientConfig:
      # Replace 'webhook-service' and 'default' with the actual
      # service name and namespace where your agent is running.
      service:
        name: webhook-service # Name of the service running the agent
        namespace: nginx-cert-manager  # Namespace of the service
        path: "/api/v1/crd/notify"    # The new endpoint in http_agent.py
        port: 443                      # Webhooks MUST use HTTPS
      # caBundle: MUST be provided. Base64-encoded CA certificate bundle to verify
      # the webhook server's certificate. cert-manager can inject this automatically.
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURuVENDQW9XZ0F3SUJBZ0lVRTkzM3NINkpnTDYxaFdDOXpnZVRuVmpkc1J3d0RRWUpLb1pJaHZjTkFRRUwKQlFBd01URXZNQzBHQTFVRUF3d21kMlZpYUc5dmF5MXpaWEoyYVdObExtNW5hVzU0TFdObGNuUXRiV0Z1WVdkbApjaTV6ZG1Nd0hoY05NalV3TkRFNU1UVTBOekF5V2hjTk1qWXdOREU1TVRVME56QXlXakF4TVM4d0xRWURWUVFECkRDWjNaV0pvYjI5ckxYTmxjblpwWTJVdWJtZHBibmd0WTJWeWRDMXRZVzVoWjJWeUxuTjJZekNDQVNJd0RRWUoKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTWlGeDB0Y05CM3c2TzZ6NFJlUUZIOFN2M0RYdm5DdApzd2JDTmlRWUgxMDgwN3Q3djNSYmtMOXh2Q3pWcVJpVC83RWVJOTBBQTBiVjhUNTkrOHJsZlFqcmdua2syV3pBClVQU1hjNk1Ud1AvL2FwUEVJeEVHMXdsSTJqekJ4MW4vRHJtbWtURTVseGFwNytjQmUrRERsTllCSGFKdlVMMksKY1o5Vzl1bk43K2VNRU9BaEgydXhpNkdpNCtKZ1VlWmROanZEdGFLQlUzSVpPNCt4QkFDZWk4THdJK2xtNEV4ZwpuVXpDajZINVRaQjd6emVZclVDS3dyNUJrL2x1aVFNWTdJVitBeC9rcmZTelB1NzVmeURRRlZvVW83NitNSWFuClMzR2k2Z0VzV0xYcndIZjY0WGZ6MWpHaFd6VmhFcER5Qis4dldRUityMWlyeUF4WkZ1cU03NTBDQXdFQUFhT0IKckRDQnFUQUxCZ05WSFE4RUJBTUNCREF3RXdZRFZSMGxCQXd3Q2dZSUt3WUJCUVVIQXdFd1pnWURWUjBSQkY4dwpYWUlQZDJWaWFHOXZheTF6WlhKMmFXTmxnaUozWldKb2IyOXJMWE5sY25acFkyVXVibWRwYm5ndFkyVnlkQzF0CllXNWhaMlZ5Z2laM1pXSm9iMjlyTFhObGNuWnBZMlV1Ym1kcGJuZ3RZMlZ5ZEMxdFlXNWhaMlZ5TG5OMll6QWQKQmdOVkhRNEVGZ1FVM2dKcjVzUGVJMStOZ0V0TnFQbWRpclg4RFdNd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQgpBR2hNcitzTU16T3NTRmVod0s1NUVsdnRYUEU1dE9zNktTUHNvckkveTJETzBoOUVuMTFrRVEyNFZaSnBkR2s2CkNlMmYrdHhoaDBTK2xEa2VqSE14aHRuaXVNb3ltUXp5UzlLV2I1b2JwOCtkVGkreEFielNCcUFhSEtJL1U2d1QKMEdnK1I2azRFVktFWm1ERDduYVVBNlZTYUozZmVlUWdoM3V0MEJwWkpmK0R4eCtvcE04T1k5OWZIdnJCVFlZYQpSSkxrZzhWcEpBRGNkK2p0TlJZTnlxMDYzYVFFK2hNZUJGM0NZVXlUd3NhMEVDQU5tM2VvdW4rQTNCaDFWaEZZCk5nRytpVENVODdsN0ZGUll3bG5IcUpYMXVtRlpJRDQvem1INzVqc1FzTXhrRDJ2MU9tY0U0WjhvU25MZTlpUDcKUGRmRGdyMzNseHBjSkNORm1ZZ256dFE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    admissionReviewVersions: ["v1"]
    sideEffects: None
    timeoutSeconds: 5 # Keep timeout short
